# Dummy Page 依赖关系与前置条件规范

## 🎯 核心问题

在跨对话续写时,某些页面依赖于之前步骤的成果:

**问题场景**:
```
用户在新对话中上传Dummy.md:
"请生成第2页执行摘要"

但第2页需要:
❌ 完整的Issue Tree (STEP 2-3的成果)
❌ 所有章节的核心发现 (其他页面的成果)
❌ 最终结论 (最后一页的成果)

→ 无法独立生成!
```

## 💡 解决方案: 页面依赖标注系统

### 依赖类型定义

```javascript
const DEPENDENCY_TYPES = {
  // Type 1: 独立页面 - 可以在任何时候独立生成
  INDEPENDENT: {
    symbol: "✅ 独立",
    description: "无依赖,可直接生成",
    examples: ["封面", "普通数据分析页"]
  },
  
  // Type 2: 前向依赖 - 需要前面某些特定页面先完成
  FORWARD_DEPENDENT: {
    symbol: "⏩ 依赖前页",
    description: "需要第X-Y页的数据/结论",
    examples: ["趋势对比页(需要基础数据页)", "深入分析页"]
  },
  
  // Type 3: 后向依赖 - 需要后面页面先完成
  BACKWARD_DEPENDENT: {
    symbol: "⏪ 依赖后页",
    description: "需要第X-Y页完成后才能总结",
    examples: ["目录/执行摘要", "章节总结页"]
  },
  
  // Type 4: 需要外部文档 - 需要用户提供特定文档
  REQUIRES_DOC: {
    symbol: "📄 需要文档",
    description: "需要用户提供[文档类型]",
    examples: ["执行摘要(需Issue Tree)", "总结页(需全部分析)"]
  },
  
  // Type 5: 双向依赖 - 既依赖前面也依赖后面
  BIDIRECTIONAL: {
    symbol: "⏸️ 最后生成",
    description: "需要前后页面都完成",
    examples: ["目录", "全局总结"]
  }
};
```

## 📋 Dummy Page 标注格式

### 标准模板

```markdown
## 第X页: [McKinsey论点标题]

**依赖关系**: [依赖类型]
**前置条件**: [具体要求]
**检查清单**: [Claude生成前必须确认的条件]
**缺失时对策**: [如果条件不满足怎么办]

**布局**: [布局类型]
**图表**: [图表类型]
**数据需求**: [数据点]
...
```

### 各类型具体示例

#### 类型1: 独立页面

```markdown
## 第5页: 中国新能源汽车市场规模持续扩大,2023年达到1.2万亿元

**依赖关系**: ✅ 独立
**前置条件**: 无
**检查清单**:
  - [ ] 无需检查,可直接生成

**布局**: 标题+单图表型
**图表**: 柱状图(2019-2023市场规模)
**数据需求**:
  - 2019-2023年市场规模数据
**信息来源**:
  - web_search: "中国新能源汽车市场规模 2023"
  - 参考来源: https://example.com/report
**Excel Sheet**: "第5页 市场规模"
```

#### 类型2: 前向依赖

```markdown
## 第8页: 特斯拉市占率从25%降至18%,本土品牌崛起

**依赖关系**: ⏩ 依赖前页
**前置条件**: 需要第5页的"市场规模数据"
**依赖页面**: 第5页
**检查清单**:
  - [ ] 确认第5页已生成
  - [ ] 确认第5页Excel中有2022-2023市场规模数据
  - [ ] 从第5页获取总市场规模作为分母

**缺失时对策**:
  - 如果第5页未完成 → 告知用户:"第8页依赖第5页数据,建议先完成第5页"
  - 如果用户坚持生成 → 先临时生成第5页的市场规模数据,再生成第8页

**布局**: 标题+左右分栏型
**图表**: 左侧饼图(市占率),右侧柱状图(各品牌销量)
**数据需求**:
  - 各品牌市占率(2022 vs 2023)
  - 依赖数据: 第5页的总市场规模
**信息来源**:
  - web_search: "特斯拉中国市场份额 2023"
  - 内部依赖: 第5页Excel "市场规模"数据
**Excel Sheet**: "第8页 市占率变化"
```

#### 类型3: 后向依赖

```markdown
## 第2页: 目录/执行摘要

**依赖关系**: ⏪ 依赖后页
**前置条件**: 需要所有正文页(第3-20页)完成
**依赖页面**: 第3-20页
**检查清单**:
  - [ ] 第3-20页全部完成
  - [ ] 每页的核心论点已提取
  - [ ] 每章的关键发现已总结

**缺失时对策**:
  - 选项1 (推荐): "执行摘要需要所有分析完成后才能生成,建议最后生成此页"
  - 选项2: "如需先占位,请提供Issue Tree文档,我基于假设生成执行摘要框架"
  - 选项3: "我可以先生成目录结构,执行摘要部分留空,待后续填充"

**布局**: 标题+项目符号型
**内容需求**:
  - 核心发现1 (来自第X-Y页)
  - 核心发现2 (来自第Z页)
  - 关键建议 (来自最后一页)
**信息来源**:
  - 内部依赖: 所有正文页的标题和关键数据
**Excel Sheet**: 无需数据Sheet
```

#### 类型4: 需要外部文档

```markdown
## 第2页: 执行摘要

**依赖关系**: 📄 需要文档
**前置条件**: 需要"Issue Tree + Hypotheses"文档
**必需文档**: 
  - STEP 3的Hypothesis Tree输出
  - 或用户提供的项目背景文档
**检查清单**:
  - [ ] 检查当前对话中是否有Issue Tree
  - [ ] 如没有,询问用户是否有该文档
  - [ ] 确认核心假设和验证结果

**缺失时对策**:
  - 情况1: 同一对话,之前完成了STEP 1-3
    → 从对话历史中提取Issue Tree信息
  
  - 情况2: 跨对话,用户未上传Issue Tree
    → "执行摘要需要基于项目的Issue Tree和核心假设。
       您有以下选择:
       1. 上传之前STEP 3生成的Hypothesis Tree文档
       2. 简要描述核心研究问题和假设
       3. 先生成第3-20页,最后基于分析结果反推执行摘要"
  
  - 情况3: 用户提供Issue Tree
    → 基于Issue Tree生成执行摘要框架

**布局**: 标题+项目符号型
**内容需求**:
  - 核心研究问题 (来自Issue Tree)
  - 主要发现 (来自Hypotheses验证)
  - 关键建议 (基于验证结果)
**信息来源**:
  - 必需: Issue Tree + Hypotheses文档
  - 可选: 已完成的分析页面
**Excel Sheet**: 无需数据Sheet
```

#### 类型5: 双向依赖

```markdown
## 第2页: 目录

**依赖关系**: ⏸️ 最后生成
**前置条件**: 
  - 需要所有正文页标题确定(第3-25页)
  - 需要章节划分明确
**依赖页面**: 第3-25页(所有正文页)
**检查清单**:
  - [ ] 所有正文页已生成
  - [ ] 每页标题确定
  - [ ] 章节结构清晰

**缺失时对策**:
  - 标准流程: "目录应该在所有页面完成后生成,请先完成第3-25页"
  
  - 快速占位: 如用户急需完整PPT
    → "我可以基于Dummy文件生成目录结构框架,
       但页码可能需要后续调整。继续吗?"
  
  - 基于Dummy生成:
    → 读取Dummy.md中所有页面标题
    → 按章节组织
    → 标注"[待确认页码]"

**布局**: 目录型
**内容需求**:
  - 每一页的标题
  - 对应页码
  - 章节分组
**信息来源**:
  - 内部依赖: 所有已生成页面的标题
  - 或基于: Dummy.md中的页面设计列表
**Excel Sheet**: 无需数据Sheet
```

## 🔍 Claude生成前检查流程

### 自动检查流程

```python
def check_dependencies_before_generate(page_number, dummy_md, completed_pages):
    """
    在生成任何页面前,自动执行依赖检查
    """
    page_spec = parse_page_from_dummy(dummy_md, page_number)
    dependency_type = page_spec['依赖关系']
    
    # Step 1: 检查依赖类型
    if dependency_type == "✅ 独立":
        return {"can_generate": True}
    
    elif dependency_type == "⏩ 依赖前页":
        required_pages = page_spec['依赖页面']
        missing = [p for p in required_pages if p not in completed_pages]
        
        if missing:
            return {
                "can_generate": False,
                "reason": f"需要先完成第{missing}页",
                "strategy": page_spec['缺失时对策']
            }
        else:
            return {"can_generate": True}
    
    elif dependency_type == "⏪ 依赖后页":
        required_pages = page_spec['依赖页面']
        missing = [p for p in required_pages if p not in completed_pages]
        
        if missing:
            return {
                "can_generate": False,
                "reason": f"建议在第{required_pages}页完成后再生成此页",
                "strategy": page_spec['缺失时对策']
            }
    
    elif dependency_type == "📄 需要文档":
        required_doc = page_spec['必需文档']
        
        if not check_document_availability(required_doc):
            return {
                "can_generate": False,
                "reason": f"需要{required_doc}",
                "strategy": page_spec['缺失时对策']
            }
    
    elif dependency_type == "⏸️ 最后生成":
        all_pages = range(3, total_pages + 1)  # 除了封面和目录
        missing = [p for p in all_pages if p not in completed_pages]
        
        if missing:
            return {
                "can_generate": False,
                "reason": "建议所有分析页完成后再生成",
                "strategy": page_spec['缺失时对策']
            }
```

### Claude响应话术

**情况1: 可以直接生成**
```
第X页: [标题]
✅ 依赖检查通过,开始生成...
[执行生成流程]
```

**情况2: 缺少依赖,提供选项**
```
第X页: [标题]
⚠️ 依赖检查: 此页依赖第Y页的数据

您有以下选择:
1. 先完成第Y页,再返回生成第X页 (推荐)
2. 我先临时生成第Y页的必要数据,再生成第X页
3. 跳过第X页,稍后再生成

请告诉我您的选择(1/2/3)?
```

**情况3: 需要外部文档**
```
第2页: 执行摘要
📄 需要Issue Tree文档

此页需要基于项目的核心假设和研究框架。请问:
1. 您有STEP 3生成的Hypothesis Tree文档吗? (上传即可)
2. 还是想让我先生成其他分析页,最后基于结果反推执行摘要?
3. 或者您可以简要描述核心研究问题,我基于此生成框架

请选择或告诉我您的情况?
```

**情况4: 建议最后生成**
```
第2页: 目录
⏸️ 建议最后生成

目录需要所有页面标题确定后才能准确生成。

建议流程:
1. 先完成第3-25页的分析内容
2. 确认所有标题和章节结构
3. 最后生成目录(基于实际完成的页面)

当然,如果您需要先看整体结构,我也可以基于Dummy文件生成临时目录框架。

继续生成目录,还是先做其他页面?
```

## 📝 完整Dummy.md模板(含依赖标注)

```markdown
# [项目名称] Dummy Pages

## 项目信息
- 创建日期: YYYY-MM-DD
- 总页数: 25页
- 预计章节: 4章

## 页面依赖关系总览 ⭐ 新增

建议生成顺序:

**第一轮: 独立页面** (可任意顺序)
- 第1页 (封面) ✅ 独立
- 第3页 (市场规模) ✅ 独立
- 第4页 (用户画像) ✅ 独立
- 第5-15页 (数据分析页) ✅ 独立

**第二轮: 前向依赖页面** (依赖第一轮)
- 第16页 (趋势总结) ⏩ 需要第3-15页
- 第18页 (竞争分析) ⏩ 需要第5,7页

**第三轮: 后向依赖页面** (最后生成)
- 第2页 (执行摘要) ⏪ 需要第3-24页
- 第25页 (结论建议) ⏪ 需要第3-24页

**特殊说明**:
- 如果跨对话续写,建议按上述顺序生成
- 如果缺少某些页面,Claude会提供应对策略
- 可以跳过依赖页,稍后再补

---

## 第1页: 封面

**依赖关系**: ✅ 独立
**前置条件**: 无
**检查清单**: 无需检查

**布局**: 标题居中型
**内容**: 
  - 主标题: [项目名称]
  - 副标题: [副标题]
**McKinsey设计**: 深蓝背景渐变
**Excel Sheet**: 无需数据Sheet

---

## 第2页: 执行摘要

**依赖关系**: 📄 需要文档 + ⏪ 依赖后页
**前置条件**: 
  - 理想: 所有分析页(第3-24页)完成
  - 最低: 需要Issue Tree + Hypotheses文档
**必需文档**: 
  - STEP 3的Hypothesis Tree
  - 或用户描述的核心研究问题
**检查清单**:
  - [ ] 检查是否有Issue Tree信息
  - [ ] 如有已完成页面,提取核心发现
  - [ ] 确认关键假设和验证结果

**缺失时对策**:
```
如果在新对话中生成此页:
1. 询问用户是否有Issue Tree文档
2. 如没有,提供三个选项:
   - 上传Issue Tree
   - 描述核心研究问题
   - 先生成分析页,最后反推执行摘要
3. 基于用户选择执行对应策略
```

**布局**: 标题+项目符号型
**内容需求**:
  - 核心发现1-3 (来自分析页)
  - 关键建议
**信息来源**:
  - 必需: Issue Tree文档或用户描述
  - 可选: 已完成分析页的核心论点
**Excel Sheet**: 无需数据Sheet

---

## 第3页: 中国新能源汽车市场规模达1.2万亿元,5年CAGR 45%

**依赖关系**: ✅ 独立
**前置条件**: 无
**检查清单**: 无需检查

**布局**: 标题+单图表型
**图表**: 柱状图+折线图组合
**数据需求**:
  - 2019-2023年市场规模
  - 同比增长率
**McKinsey设计**:
  - 配色: SECONDARY_BLUE主色
  - 标注: 2023年达1.2万亿
  - 洞察框: CAGR 45%,全球最快
**信息来源**:
  - web_search: "中国新能源汽车市场规模 2023"
  - 参考来源:
    - https://www.199it.com/archives/1234567.html
      (艾瑞咨询: 2023年新能源汽车市场报告)
**Excel Sheet**: "第3页 市场规模"

---

## 第8页: 特斯拉市占率从25%降至18%,本土品牌崛起

**依赖关系**: ⏩ 依赖前页
**前置条件**: 需要第3页的市场规模数据
**依赖页面**: 第3页
**检查清单**:
  - [ ] 第3页已完成
  - [ ] 第3页Excel有2022-2023总市场规模
  - [ ] 可从第3页获取分母数据

**缺失时对策**:
```
如果第3页未完成:
1. 告知用户依赖关系
2. 提供选项:
   - 先完成第3页(推荐)
   - 临时搜索市场规模数据,直接生成第8页
3. 如选择选项2,在Excel中标注数据来源
```

**布局**: 标题+左右分栏型
**图表**: 
  - 左: 饼图(2023品牌市占率)
  - 右: 柱状图(各品牌销量变化)
**数据需求**:
  - 特斯拉/比亚迪/蔚来等市占率
  - 2022 vs 2023对比
  - 依赖: 第3页的总市场规模
**McKinsey设计**:
  - 特斯拉用红色高亮
  - 本土品牌用蓝色系
  - 洞察框: 本土品牌合计占比超60%
**信息来源**:
  - web_search: "特斯拉中国市场份额 2023"
  - web_search: "比亚迪市场份额 2023"
  - 内部依赖: 第3页Excel "市场规模"
**Excel Sheet**: "第8页 品牌竞争"

---

## 第16页: 本章小结 - 市场高速增长但竞争格局未稳定

**依赖关系**: ⏩ 依赖前页
**前置条件**: 需要第3-15页完成
**依赖页面**: 第3-15页(整个第一章)
**检查清单**:
  - [ ] 第3-15页全部完成
  - [ ] 提取每页核心论点
  - [ ] 总结章节关键发现

**缺失时对策**:
```
如果部分页面未完成:
1. 列出已完成和未完成的页面
2. 基于已完成页面生成部分小结
3. 标注"[待第X,Y页完成后补充]"
4. 建议完成所有页后重新生成此页
```

**布局**: 洞察总结页
**内容需求**:
  - 核心发现1: 市场规模(第3页)
  - 核心发现2: 增长驱动(第5-7页)
  - 核心发现3: 竞争格局(第8-12页)
  - 核心发现4: 用户特征(第13-15页)
**McKinsey设计**:
  - 4个洞察框,2×2排列
  - 每个框对应一个核心发现
  - 底部关键数据摘要
**信息来源**:
  - 内部依赖: 第3-15页的核心论点和关键数据
**Excel Sheet**: 无需新数据,引用之前页面

---

## 第25页: 结论与建议

**依赖关系**: ⏸️ 最后生成
**前置条件**: 所有分析页(第3-24页)完成
**依赖页面**: 第3-24页
**检查清单**:
  - [ ] 所有章节分析完成
  - [ ] 核心发现明确
  - [ ] 假设验证结论清晰

**缺失时对策**:
```
此页必须最后生成:
1. 提醒用户: "结论页需要基于完整分析,建议最后生成"
2. 如用户坚持先生成:
   - 基于Issue Tree生成假设性结论框架
   - 标注"[待验证]"
   - 待所有分析完成后重新生成
```

**布局**: 标题+项目符号型
**内容需求**:
  - 核心结论3条
  - 战略建议3条
  - 行动计划
**McKinsey设计**:
  - 结论用深蓝背景框
  - 建议用浅蓝背景框
  - 行动计划用表格
**信息来源**:
  - 内部依赖: 所有分析页的核心发现
  - 综合: Issue Tree的假设验证结果
**Excel Sheet**: 无需新数据,引用和总结

---

[继续其他页面...]
```

## 🎯 实施要点

### 在STEP 5设计Dummy时

Claude必须:
1. ✅ 为每一页标注依赖关系
2. ✅ 明确列出前置条件
3. ✅ 提供缺失时对策
4. ✅ 在Dummy开头添加"页面依赖关系总览"
5. ✅ 给出建议的生成顺序

### 在STEP 6-7生成页面时

Claude必须:
1. ✅ 生成前自动检查依赖关系
2. ✅ 如有缺失,提供清晰的选项
3. ✅ 等待用户确认后再继续
4. ✅ 记录依赖数据的来源页面
5. ✅ 在Excel中标注依赖关系

### 跨对话续写时

用户上传Dummy.md后,Claude必须:
1. ✅ 先读取"页面依赖关系总览"
2. ✅ 检查用户要生成的页面类型
3. ✅ 自动执行依赖检查
4. ✅ 如有问题,主动询问而非假设
5. ✅ 提供灵活的应对策略

## 📚 总结

### 核心价值

1. **防止无效生成**: 避免生成缺少关键信息的页面
2. **提升用户体验**: 清晰告知依赖关系,用户自主选择
3. **支持灵活续写**: 不强制顺序,但提供建议
4. **保证质量**: 确保每页有必要的数据支撑

### 依赖标注的三个层次

**Level 1: 基础标注** (最低要求)
```markdown
**依赖关系**: [类型符号]
**前置条件**: [要求]
```

**Level 2: 完整标注** (推荐)
```markdown
**依赖关系**: [类型符号]
**前置条件**: [要求]
**检查清单**: [具体检查项]
**缺失时对策**: [应对方案]
```

**Level 3: 详细标注** (复杂项目)
```markdown
**依赖关系**: [类型符号]
**前置条件**: [要求]
**依赖页面**: [具体页码]
**必需文档**: [文档类型]
**检查清单**: [具体检查项]
**缺失时对策**: [多个选项]
**依赖数据**: [来源说明]
```

---

**版本**: V3.1 - Dependency-Aware Architecture
**日期**: 2025-10-26
**作者**: Qianru Tian
